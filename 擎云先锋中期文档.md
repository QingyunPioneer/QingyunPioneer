# 机械
## 功能设计与实现
![功能设计](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1.png)
初版设计选取了一个直杆，可以配合一个舵机直接实现传递小球的功能，传递效率高速度快。后发现无法安放，会与大尺寸取球框和储球筐冲突，导致小球超出规则限定的长度，故在草图阶段就pass。
改良1：采取了双杆折叠的形式，保存了取球框和储球筐的大小，折叠后恰好卡在限定尺寸内，实现了尺寸最大化。
改良2：在取球框处未考虑安装使取球框转动的装置，但原先的90°框可能会出现部分小球无法掉落的球筐，于是决定采用斜坡设计。另一侧为了保障取球面积的最大化，不做改动。
思路补充：由于储球筐的大尺寸，同时电子元件需要底盘的位置，于是决定采用架空的设计。


### 开发历程
1.目标设立
首先我们研读规则，决定采取1号车和2号车分工协作，取球为主，抢夺小球为辅的策略，在两辆车同时具备独立拾取小球的功能外，让2号车把拾取到的小球可以传递至1号车，以符合规则中首先以1号车球数定输赢的判准，同时2号车可以去拾取其他战队球筐里已经收集好的小球。据此
1车目标：
a.拾取小球
b.储球框
2车目标：
a.拾取小球
b.传递小球
c.抢夺小球

2.拾取小球功能实现的设计思路
   我们准备先参考网上的设计方案，再根据实践gaijing我们参考了网上诸多拾取乒乓球，网球的视频。发现主流的设计思路有，滚轮加清扫转轴，铲子，橡皮筋加球筐，机械臂的四种形式。出于对每种方案效率不确定性的考量，我们决定对两辆小车应用不同的方案。以下是对四种主流方案的测评简述。
a.大滚轮加清扫转轴/小滚轮传递
![2.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/2%2C1.png) ![2.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/2.2.png)
  一次性拾取小球数量多，效率高，但大滚轮的隔板间距需要考量好，小球的重力可能会影响传递效率。小滚轮的实现困难性较高和稳定性较低

b.铲子
![2.3](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/2.3.png)
 一次性拾取小球数目较多，但送球到框中的传递精确性不足，另外小球的滚动性和材料的厚度可能影响取球成功率。

c.橡皮筋加取球筐
![2.4](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/2.4.png)
一次性拾取小球的数目由球筐而定，上限不定，只要传动杆与球筐刚好接触，传递小球效率可以保证。

d.机械臂
![2.5](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/2.5.png)
一次性拾取小球的数量只一个，改良后也难以突破。同时传递效率低。但灵活性强，可以考虑作为抢夺对手小球的装置。

综上，考虑到拾取小球的主要目的，决定选取取球无上限的橡皮筋+取球框作为1车的取球装置，选取较稳妥的滚轮作为2车的取球装置。另外给2车安装机械臂拾取对手的小球。

3.实现（一车）
![3.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/abf01945839820099e2b616be9904cfeb7394bdb/3.1.png) ![3.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.2.png)
![3.3](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.3.png) ![3.4](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.4.png)
过程中尺寸进行了几次调整，因为连杆，连接元件，取球框的长款都最大化的卡住了规则限制，所以一点点考虑不到位，都会导致全盘的改动。前期的储球筐设定在17mm的宽度，但后续发现连杆连接处的宽度加上零件本身的厚度，会影响原先设定的取球框17mm不够，故改成15mm。另外会导致杆件与麦轮产生冲突，如图。
![3.5](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.5.png) ![3.6](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.6.png) ![3.7](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.7.png)
另外在打孔时也出现莫名bug的问题，还是软件操控不娴熟，于是只能重新创建实体。
![3.8](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.8.png) ![3.9](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.9.png) ![3.10](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/3.10.png)

4.2（二车）
二车主要想通过滚轮式收集器收集小球，且由于赛事规则，考虑为二车收集装置后部设计为可控旋转结构，以便使一车携带的小球更多。
![4.2.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/abf01945839820099e2b616be9904cfeb7394bdb/%E5%9B%BE%E7%89%874.2.1.png) ![4.2.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E5%9B%BE%E7%89%874.2.2.png)










考虑到规则中对小车尺寸的要求，滚轮与小车的连接杆设计的有些长。导致滚轮能够收集的小球未必能够达到预期，因此在后期估计还会对滚轮做一些改动。同时由于时间原因，二车收集室后部仍未改进，目标为设计成可控制旋转式，且会设计突起，用以与一车侧面凹槽相契合，保证小球的转移。

5.打印
打印的过程比较顺利，没有出现炒面和坏件的情况。
![5.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/5.1.png) ![5.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/5.2.png) 
![5.3](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/5.3.png) ![5.4](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/5.4.png)


另外在打印切片前还做了一些细节调整，比如增加孔位，以便后续改装和灵活调整连杆，增加了一些设计感，以及增加了凹槽与2车对接。

# 电控
## bsp这部分内容定义了舵机和转机的转动，其中的难点是对相应的角度和占空比是计算以及对应代码的书写
![代码1.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%811.1.png)
![代码1.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%811.2.png)
![代码2.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%812.1%20(2).png)
![代码2.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%81%E4%BB%A3%E7%A0%812.2.png)
![代码2.3](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%812.3%20(2).png)

## ps2这部分是接收信息和发送信息的部分，这部分是两个进行信息交互的关键，其中的read和get函数是其中的核心，代码如图
![代码3.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%813.1%20(2).png)
![代码3.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%813.2%20(2).png)
![代码4.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%814%E3%80%821.png)
![代码4.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%814.2.png)

## congtroltask这部分是调用相应的函数，使得舵机和马达能够运转起来
![代码5.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%815.1.png)
![代码6.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%816.1.png)

## DecodeTask这部分是对从ps2中获取信息的解码，从而使得我们可以对起进行相应的使用
![代码7.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%817.1.png)
![代码7.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%817.2.png)
![代码8.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%818.1.png)
![代码8.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%818.2.png)

## BaseTask这部分是congtroltask和Decodetask的核心部分，是我们这几部分的基石
![代码9.1](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%819.1.png)
![代码9.2](https://github.com/QingyunPioneer/QingyunPioneer/blob/main/%E4%BB%A3%E7%A0%819.2.png)